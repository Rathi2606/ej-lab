HTML — nonblocking.html
<!DOCTYPE html>
<html>
<head><title>Non-Blocking Read</title></head>
<body>
  <form action="NonBlockingServlet" method="post">
    Enter Text: <input name="data"><input type="submit" value="Submit">
  </form>
</body>
</html>

Java — NonBlockingServlet.java (async)
import java.io.*; import javax.servlet.*; import javax.servlet.http.*; import javax.servlet.annotation.*;

@WebServlet(value="/NonBlockingServlet", asyncSupported=true)
public class NonBlockingServlet extends HttpServlet {
  public void doPost(HttpServletRequest req, HttpServletResponse res)
      throws IOException, ServletException {
    res.setContentType("text/html"); AsyncContext ctx=req.startAsync();
    ServletInputStream in=req.getInputStream();
    in.setReadListener(new ReadListener(){
      StringBuilder sb=new StringBuilder();
      public void onDataAvailable() throws IOException {
        byte[] buf=new byte[1024]; int len;
        while(in.isReady() && (len=in.read(buf))!=-1) sb.append(new String(buf,0,len));
      }
      public void onAllDataRead() throws IOException {
        PrintWriter out=ctx.getResponse().getWriter();
        out.println("<h2>Received: "+sb.toString()+"</h2>"); ctx.complete();
      }
      public void onError(Throwable t){ t.printStackTrace(); }
    });
  }
}
